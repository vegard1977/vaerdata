<!-- V√¶rdata Siljan v1.10.4 -->
<!DOCTYPE html>
<html lang="no">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>V√¶rdata Siljan</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: #1a1a2e;
      color: #eee;
      padding: 20px;
      min-height: 100vh;
    }
    h1 { text-align: center; margin-bottom: 10px; font-size: 1.5rem; }
    .updated { text-align: center; color: #888; font-size: 0.85rem; margin-bottom: 20px; }
    .section-title {
      font-size: 0.85rem;
      color: #666;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin: 30px 0 15px 0;
      padding-bottom: 5px;
      border-bottom: 1px solid #333;
      max-width: 1200px;
      margin-left: auto;
      margin-right: auto;
    }
    .section-title:first-of-type { margin-top: 0; }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 15px;
      max-width: 1200px;
      margin: 0 auto;
    }
    .card {
      background: #252542;
      border-radius: 10px;
      padding: 15px;
    }
    .card h2 {
      font-size: 0.9rem;
      color: #888;
      margin-bottom: 10px;
      border-bottom: 1px solid #333;
      padding-bottom: 5px;
    }
    .card.regional { border-left: 3px solid #8b5cf6; }
    .card.metno { border-left: 3px solid #06b6d4; }
    .card.water { border-left: 3px solid #3b82f6; }
    .card.police { border-left: 3px solid #f59e0b; }
    .card.solar { border-left: 3px solid #fbbf24; }
    .card.calculator { border-left: 3px solid #a855f7; }
    .card.alert { border-left: 3px solid #22c55e; }
    .card.alert.yellow { border-left-color: #eab308; background: #2a2a1e; }
    .card.alert.orange { border-left-color: #f97316; background: #2a241e; }
    .card.alert.red { border-left-color: #ef4444; background: #2a1e1e; }
    .value { font-size: 2rem; font-weight: bold; }
    .unit { font-size: 0.9rem; color: #888; }
    .beaufort { font-size: 1rem; color: #4ade80; margin-top: 5px; }
    .stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 10px; }
    .stats-2 { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-top: 10px; }
    .stats-4 { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-top: 10px; }
    .stat { text-align: center; }
    .stat-label { font-size: 0.7rem; color: #666; }
    .stat-value { font-size: 1rem; font-weight: bold; }
    .stat-detail { font-size: 0.65rem; color: #888; }
    .trend-up { color: #4ade80; }
    .trend-down { color: #f87171; }
    .sun { color: #fbbf24; }
    .wind-calm { color: #4ade80; }
    .wind-moderate { color: #fbbf24; }
    .wind-strong { color: #f87171; }
    .temp-cold { color: #60a5fa; }
    .temp-warm { color: #f87171; }
    .uv-low { color: #4ade80; }
    .uv-moderate { color: #fbbf24; }
    .uv-high { color: #f97316; }
    .uv-very-high { color: #ef4444; }
    .uv-extreme { color: #a855f7; }
    .wind-dir { font-size: 1.5rem; }
    
    /* Water level colors - v1.8 */
    .fill-critical { color: #ef4444; }
    .fill-low { color: #f97316; }
    .fill-normal { color: #4ade80; }
    .fill-high { color: #eab308; }
    .fill-over { color: #f97316; }
    
    /* Forecast styles */
    .forecast-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 10px;
      margin-top: 10px;
    }
    .forecast-day {
      text-align: center;
      padding: 10px 5px;
      background: #1a1a2e;
      border-radius: 8px;
    }
    .forecast-day .day-name { font-size: 0.75rem; color: #888; margin-bottom: 5px; }
    .forecast-day .weather-icon { font-size: 1.5rem; margin: 5px 0; }
    .forecast-day .temp-range { font-size: 0.8rem; }
    .forecast-day .precip { font-size: 0.7rem; color: #60a5fa; margin-top: 3px; }
    
    /* Alert styles */
    .alert-content { font-size: 0.85rem; line-height: 1.4; }
    .alert-title { font-weight: bold; margin-bottom: 5px; }
    .alert-desc { color: #aaa; }
    .alert-none { color: #4ade80; }
    .alert-item { margin-bottom: 10px; padding-bottom: 10px; border-bottom: 1px solid #333; }
    .alert-item:last-child { margin-bottom: 0; padding-bottom: 0; border-bottom: none; }
    .alert-water { color: #60a5fa; }
    .alert-water-warning { color: #f97316; }
    .alert-water-danger { color: #ef4444; }
    
    /* Water level grid */
    .water-grid {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 10px;
      margin-top: 10px;
    }
    .water-item {
      text-align: center;
      padding: 12px 8px;
      background: #1a1a2e;
      border-radius: 8px;
    }
    .water-item .reservoir-name { font-size: 0.75rem; color: #888; margin-bottom: 8px; font-weight: 500; }
    .water-item .water-level { font-size: 1.1rem; font-weight: bold; }
    .water-item .water-ref { font-size: 0.65rem; color: #666; margin-top: 4px; }
    .water-item .fill-pct { font-size: 1.3rem; font-weight: bold; margin-top: 6px; }
    .water-item .water-trend { font-size: 1rem; margin-left: 5px; }
    .water-trend-up { color: #4ade80; }
    .water-trend-down { color: #60a5fa; }
    .water-trend-stable { color: #888; }
    .water-item .fill-bar {
      height: 4px;
      background: #333;
      border-radius: 2px;
      margin-top: 6px;
      overflow: hidden;
    }
    .water-item .fill-bar-inner {
      height: 100%;
      border-radius: 2px;
      transition: width 0.3s;
    }
    
    /* Police log styles */
    .police-list { margin-top: 10px; }
    .police-item {
      padding: 12px;
      background: #1a1a2e;
      border-radius: 8px;
      margin-bottom: 10px;
    }
    .police-item:last-child { margin-bottom: 0; }
    .police-item .police-title { font-size: 0.85rem; font-weight: bold; color: #f59e0b; margin-bottom: 5px; }
    .police-item .police-desc { font-size: 0.8rem; color: #aaa; line-height: 1.4; }
    .police-item .police-time { font-size: 0.7rem; color: #666; margin-top: 5px; }
    
    @media (max-width: 768px) {
      .forecast-grid {
        grid-template-columns: repeat(4, 1fr);
      }
      .forecast-day:nth-child(n+5) {
        display: none;
      }
      .water-grid {
        grid-template-columns: repeat(2, 1fr);
      }
      .water-item:nth-child(5) {
        grid-column: 1 / -1;
        max-width: 50%;
        margin: 0 auto;
      }
    }
  </style>
</head>
<body>
  <h1>üå§Ô∏è V√¶rdata Siljan</h1>
  <div class="updated">Sist oppdatert: <span id="lastUpdate">--</span></div>

  <!-- Farevarsler √∏verst -->
  <div class="grid" style="margin-bottom: 15px;">
    <div class="card alert" id="alertCard" style="grid-column: 1 / -1;">
      <h2>‚ö†Ô∏è Varsler</h2>
      <div class="alert-content" id="alertContent">
        <span class="alert-none">‚úì Ingen aktive varsler</span>
      </div>
    </div>
  </div>
  
  <div class="section-title">üìç Lokale m√•linger</div>
  <div class="grid">
    <!-- Temperatur -->
    <div class="card">
      <h2>üå°Ô∏è Temperatur</h2>
      <span class="value" id="temp">--</span><span class="unit">¬∞C</span>
      <div class="stats">
        <div class="stat">
          <div class="stat-label">24t min/max</div>
          <div class="stat-value"><span id="temp24min">--</span> / <span id="temp24max">--</span></div>
          <div class="stat-detail" id="temp24times">--</div>
        </div>
        <div class="stat">
          <div class="stat-label">7d min/max</div>
          <div class="stat-value"><span id="temp7min">--</span> / <span id="temp7max">--</span></div>
          <div class="stat-detail" id="temp7times">--</div>
        </div>
        <div class="stat">
          <div class="stat-label">30d min/max</div>
          <div class="stat-value"><span id="temp30min">--</span> / <span id="temp30max">--</span></div>
          <div class="stat-detail" id="temp30times">--</div>
        </div>
      </div>
    </div>

    <!-- Irradiance -->
    <div class="card">
      <h2>‚òÄÔ∏è Solinnstr√•ling</h2>
      <span class="value" id="irr">--</span><span class="unit">W/m¬≤</span>
      <div class="stats">
        <div class="stat">
          <div class="stat-label">Lux</div>
          <div class="stat-value sun" id="lux">--</div>
        </div>
        <div class="stat">
          <div class="stat-label">Maks i dag</div>
          <div class="stat-value" id="irrMax">--</div>
          <div class="stat-detail" id="irrMaxTime">--</div>
        </div>
        <div class="stat">
          <div class="stat-label">Solskinn 24t</div>
          <div class="stat-value sun" id="sun24">--</div>
        </div>
      </div>
    </div>

    <!-- UV-indeks -->
    <div class="card">
      <h2>‚òÄÔ∏è UV-indeks</h2>
      <span class="value" id="uv">--</span>
      <div class="beaufort" id="uvLevel">--</div>
      <div class="stats">
        <div class="stat">
          <div class="stat-label">Maks 24t</div>
          <div class="stat-value" id="uv24max">--</div>
          <div class="stat-detail" id="uv24time">--</div>
        </div>
        <div class="stat">
          <div class="stat-label">Maks 7d</div>
          <div class="stat-value" id="uv7max">--</div>
          <div class="stat-detail" id="uv7date">--</div>
        </div>
        <div class="stat">
          <div class="stat-label">Maks 30d</div>
          <div class="stat-value" id="uv30max">--</div>
          <div class="stat-detail" id="uv30date">--</div>
        </div>
      </div>
    </div>

    <!-- Vind -->
    <div class="card">
      <h2>üí® Vind</h2>
      <span class="value" id="wind">--</span><span class="unit">m/s</span>
      <div class="beaufort" id="beaufort">--</div>
      <div class="stats">
        <div class="stat">
          <div class="stat-label">Maks 24t</div>
          <div class="stat-value" id="wind24max">--</div>
          <div class="stat-detail" id="wind24time">--</div>
        </div>
        <div class="stat">
          <div class="stat-label">Maks 7d</div>
          <div class="stat-value" id="wind7max">--</div>
          <div class="stat-detail" id="wind7time">--</div>
        </div>
        <div class="stat">
          <div class="stat-label">Maks 30d</div>
          <div class="stat-value" id="wind30max">--</div>
          <div class="stat-detail" id="wind30time">--</div>
        </div>
      </div>
    </div>

    <!-- Nedb√∏r -->
    <div class="card">
      <h2>üåßÔ∏è Nedb√∏r</h2>
      <span class="value" id="rainToday">--</span><span class="unit">mm i dag</span>
      <div class="stats">
        <div class="stat">
          <div class="stat-label">Siste 24t</div>
          <div class="stat-value" id="rain24">--</div>
        </div>
        <div class="stat">
          <div class="stat-label">Siste 7d</div>
          <div class="stat-value" id="rain7">--</div>
        </div>
        <div class="stat">
          <div class="stat-label">Siste 30d</div>
          <div class="stat-value" id="rain30">--</div>
        </div>
      </div>
    </div>

    <!-- Nedb√∏r statistikk -->
    <div class="card">
      <h2>üìä Nedb√∏r statistikk</h2>
      <div class="stats">
        <div class="stat">
          <div class="stat-label">Maks dag 7d</div>
          <div class="stat-value" id="rainMax7">--</div>
          <div class="stat-detail" id="rainMax7date">--</div>
        </div>
        <div class="stat">
          <div class="stat-label">Maks dag 30d</div>
          <div class="stat-value" id="rainMax30">--</div>
          <div class="stat-detail" id="rainMax30date">--</div>
        </div>
        <div class="stat">
          <div class="stat-label">Regndager</div>
          <div class="stat-value"><span id="rainDays7">--</span> / <span id="rainDays30">--</span></div>
          <div class="stat-detail">(7d / 30d)</div>
        </div>
      </div>
      <div class="stats-2">
        <div class="stat">
          <div class="stat-label">Lengste t√∏rrperiode</div>
          <div class="stat-value" id="dryStreak">--</div>
          <div class="stat-detail">(siste 30d)</div>
        </div>
        <div class="stat">
          <div class="stat-label">Snitt per regndag</div>
          <div class="stat-value" id="rainAvgPerDay">--</div>
          <div class="stat-detail">(siste 30d)</div>
        </div>
      </div>
    </div>

    <!-- Fuktighet & Dugpunkt -->
    <div class="card">
      <h2>üíß Fuktighet</h2>
      <span class="value" id="hum">--</span><span class="unit">%</span>
      <div class="stats">
        <div class="stat">
          <div class="stat-label">Dugpunkt</div>
          <div class="stat-value" id="dew">--</div>
        </div>
        <div class="stat">
          <div class="stat-label">24t min/max</div>
          <div class="stat-value"><span id="hum24min">--</span>/<span id="hum24max">--</span></div>
          <div class="stat-detail" id="hum24times">--</div>
        </div>
        <div class="stat">
          <div class="stat-label">Snitt 7d</div>
          <div class="stat-value" id="hum7avg">--</div>
        </div>
      </div>
    </div>

    <!-- Trykk -->
    <div class="card">
      <h2>üåÄ Lufttrykk</h2>
      <span class="value" id="press">--</span><span class="unit">hPa</span>
      <div class="stats">
        <div class="stat">
          <div class="stat-label">Trend 3t</div>
          <div class="stat-value" id="pressTrend">--</div>
        </div>
        <div class="stat">
          <div class="stat-label">24t min/max</div>
          <div class="stat-value"><span id="press24min">--</span>/<span id="press24max">--</span></div>
          <div class="stat-detail" id="press24times">--</div>
        </div>
        <div class="stat">
          <div class="stat-label">Snitt 7d</div>
          <div class="stat-value" id="press7avg">--</div>
        </div>
      </div>
    </div>
  </div>

  <div class="section-title">üåê Met.no Prognose</div>
  <div class="grid">
    <!-- 7-dagers varsel -->
    <div class="card metno" style="grid-column: 1 / -1;">
      <h2>üìÖ V√¶rvarsel 7 dager</h2>
      <div class="forecast-grid" id="forecastGrid">
        <div class="forecast-day"><div class="day-name">--</div><div class="weather-icon">--</div><div class="temp-range">--</div></div>
        <div class="forecast-day"><div class="day-name">--</div><div class="weather-icon">--</div><div class="temp-range">--</div></div>
        <div class="forecast-day"><div class="day-name">--</div><div class="weather-icon">--</div><div class="temp-range">--</div></div>
        <div class="forecast-day"><div class="day-name">--</div><div class="weather-icon">--</div><div class="temp-range">--</div></div>
        <div class="forecast-day"><div class="day-name">--</div><div class="weather-icon">--</div><div class="temp-range">--</div></div>
        <div class="forecast-day"><div class="day-name">--</div><div class="weather-icon">--</div><div class="temp-range">--</div></div>
        <div class="forecast-day"><div class="day-name">--</div><div class="weather-icon">--</div><div class="temp-range">--</div></div>
      </div>
    </div>

    <!-- Vindkast & Retning -->
    <div class="card metno">
      <h2>üí® Vindkast & Retning</h2>
      <span class="value" id="windGust">--</span><span class="unit">m/s</span>
      <div class="stats-2">
        <div class="stat">
          <div class="stat-label">Retning</div>
          <div class="stat-value"><span class="wind-dir" id="windDirArrow">--</span> <span id="windDirText">--</span></div>
          <div class="stat-detail" id="windDirDeg">--</div>
        </div>
        <div class="stat">
          <div class="stat-label">Maks kast 24t</div>
          <div class="stat-value" id="gust24max">--</div>
          <div class="stat-detail" id="gust24time">--</div>
        </div>
      </div>
    </div>

    <!-- Skydekke & T√•ke -->
    <div class="card metno">
      <h2>‚òÅÔ∏è Skydekke & T√•ke</h2>
      <span class="value" id="clouds">--</span><span class="unit">%</span>
      <div class="stats">
        <div class="stat">
          <div class="stat-label">T√•ke</div>
          <div class="stat-value" id="fog">--</div>
        </div>
        <div class="stat">
          <div class="stat-label">Min 24t</div>
          <div class="stat-value" id="clouds24min">--</div>
          <div class="stat-detail" id="clouds24minTime">--</div>
        </div>
        <div class="stat">
          <div class="stat-label">Maks 24t</div>
          <div class="stat-value" id="clouds24max">--</div>
          <div class="stat-detail" id="clouds24maxTime">--</div>
        </div>
      </div>
    </div>

    <!-- Nedb√∏r & Torden sannsynlighet -->
    <div class="card metno">
      <h2>üåßÔ∏è Sannsynlighet & Varsel</h2>
      <div class="stats-2">
        <div class="stat">
          <div class="stat-label">Nedb√∏r n√•</div>
          <div class="stat-value" id="precipProb">--</div>
        </div>
        <div class="stat">
          <div class="stat-label">Neste time</div>
          <div class="stat-value" id="precipNextHour">--</div>
        </div>
      </div>
      <div class="stats-2">
        <div class="stat">
          <div class="stat-label">Torden n√•</div>
          <div class="stat-value" id="thunderProb">--</div>
        </div>
        <div class="stat">
          <div class="stat-label">Maks torden 24t</div>
          <div class="stat-value" id="thunderProb24max">--</div>
          <div class="stat-detail" id="thunderProb24time">--</div>
        </div>
      </div>
    </div>
  </div>

  <div class="section-title">üìç Siljan regionalt</div>
  <div class="grid">
    <!-- Siljan Temperatur Regional -->
    <div class="card regional">
      <h2>üå°Ô∏è Temperatur (regionalt)</h2>
      <div class="stats-2">
        <div class="stat">
          <div class="stat-label">Min i dag</div>
          <div class="stat-value" id="siljanTempMin">--</div>
        </div>
        <div class="stat">
          <div class="stat-label">Max i dag</div>
          <div class="stat-value" id="siljanTempMax">--</div>
        </div>
      </div>
      <div class="stats-4">
        <div class="stat">
          <div class="stat-label">Laveste 7d</div>
          <div class="stat-value" id="siljanTempMin7">--</div>
          <div class="stat-detail" id="siljanTempMin7date">--</div>
        </div>
        <div class="stat">
          <div class="stat-label">H√∏yeste 7d</div>
          <div class="stat-value" id="siljanTempMax7">--</div>
          <div class="stat-detail" id="siljanTempMax7date">--</div>
        </div>
        <div class="stat">
          <div class="stat-label">Laveste 30d</div>
          <div class="stat-value" id="siljanTempMin30">--</div>
          <div class="stat-detail" id="siljanTempMin30date">--</div>
        </div>
        <div class="stat">
          <div class="stat-label">H√∏yeste 30d</div>
          <div class="stat-value" id="siljanTempMax30">--</div>
          <div class="stat-detail" id="siljanTempMax30date">--</div>
        </div>
      </div>
    </div>

    <!-- Siljan Vind Regional -->
    <div class="card regional">
      <h2>üí® Vind (regionalt maks)</h2>
      <span class="value" id="siljanWindMax">--</span><span class="unit">m/s</span>
      <div class="beaufort" id="siljanWindBeaufort">--</div>
      <div class="stats">
        <div class="stat">
          <div class="stat-label">Maks 7d</div>
          <div class="stat-value" id="siljanWind7max">--</div>
          <div class="stat-detail" id="siljanWind7date">--</div>
        </div>
        <div class="stat">
          <div class="stat-label">Maks 30d</div>
          <div class="stat-value" id="siljanWind30max">--</div>
          <div class="stat-detail" id="siljanWind30date">--</div>
        </div>
        <div class="stat">
          <div class="stat-label">Snitt maks/dag</div>
          <div class="stat-value" id="siljanWindAvg">--</div>
          <div class="stat-detail">(30d)</div>
        </div>
      </div>
    </div>

    <!-- Siljan Nedb√∏r Regional -->
    <div class="card regional">
      <h2>üåßÔ∏è Nedb√∏r (regionalt maks)</h2>
      <span class="value" id="siljanRainMax">--</span><span class="unit">mm i dag</span>
      <div class="stats">
        <div class="stat">
          <div class="stat-label">Maks dag 7d</div>
          <div class="stat-value" id="siljanRain7max">--</div>
          <div class="stat-detail" id="siljanRain7date">--</div>
        </div>
        <div class="stat">
          <div class="stat-label">Maks dag 30d</div>
          <div class="stat-value" id="siljanRain30max">--</div>
          <div class="stat-detail" id="siljanRain30date">--</div>
        </div>
        <div class="stat">
          <div class="stat-label">Snitt maks/dag</div>
          <div class="stat-value" id="siljanRainAvg">--</div>
          <div class="stat-detail">(30d)</div>
        </div>
      </div>
    </div>
  </div>

  <div class="section-title">üíß Vannstander Siljanvassdraget</div>
  <div class="grid">
    <div class="card water" style="grid-column: 1 / -1;">
      <h2>üèîÔ∏è Magasinfylling</h2>
      <div class="water-grid" id="waterGrid">
        <div class="water-item"><div class="reservoir-name">--</div><div class="fill-pct">--%</div></div>
        <div class="water-item"><div class="reservoir-name">--</div><div class="fill-pct">--%</div></div>
        <div class="water-item"><div class="reservoir-name">--</div><div class="fill-pct">--%</div></div>
        <div class="water-item"><div class="reservoir-name">--</div><div class="fill-pct">--%</div></div>
        <div class="water-item"><div class="reservoir-name">--</div><div class="fill-pct">--%</div></div>
      </div>
      <div class="updated" style="margin-top: 15px; margin-bottom: 0;">
        Kilde: <a href="https://www.skagerakkraft.no/vassdrag/vannstand/" target="_blank" style="color: #888;">Skagerak Kraft</a> ¬∑ 
        Fyllingsgrad: LRV = 0%, HRV = 100% ¬∑ 
        Oppdatert: <span id="waterUpdate">--</span>
      </div>
    </div>
  </div>

  <div class="section-title">üöî Politiloggen Siljan</div>
  <div class="grid">
    <div class="card police" style="grid-column: 1 / -1;">
      <h2>üìã Siste hendelser</h2>
      <div class="police-list" id="policeList">
        <div class="police-item">
          <div class="police-title">--</div>
          <div class="police-desc">Laster...</div>
        </div>
      </div>
      <div class="updated" style="margin-top: 15px; margin-bottom: 0;">
        Kilde: <a href="https://www.politiet.no/politiloggen" target="_blank" style="color: #888;">Politiet.no</a>
      </div>
    </div>
  </div>

  <div class="section-title">‚òÄÔ∏è Solcelleanlegg</div>
  <div class="grid">
    <div class="card solar">
      <h2>üîå Mitt anlegg (7.2 kWp)</h2>
      <span class="value" id="solarInverter">--</span><span class="unit">kW</span>
      <div class="stats">
        <div class="stat">
          <div class="stat-label">Estimert</div>
          <div class="stat-value sun" id="solarEstimated">--</div>
        </div>
        <div class="stat">
          <div class="stat-label">Ytelse</div>
          <div class="stat-value" id="solarPerformance">--</div>
        </div>
        <div class="stat">
          <div class="stat-label">Irradiance</div>
          <div class="stat-value" id="solarIrr">--</div>
        </div>
      </div>
      <div class="updated" style="margin-top: 15px; margin-bottom: 0;">
        Oppdatert: <span id="solarUpdate">--</span>
      </div>
    </div>

    <div class="card calculator">
      <h2>üßÆ PV-kalkulator</h2>
      <div class="stats">
        <div class="stat">
          <div class="stat-label">Din kWp</div>
          <input type="number" id="calcKwp" value="7.2" step="0.1" min="0.1" max="50" style="width: 70px; padding: 5px; border-radius: 5px; border: 1px solid #444; background: #1a1a2e; color: #eee; text-align: center;">
        </div>
        <div class="stat">
          <div class="stat-label">Takvinkel (¬∞)</div>
          <input type="number" id="calcTilt" value="33" step="1" min="0" max="90" style="width: 70px; padding: 5px; border-radius: 5px; border: 1px solid #444; background: #1a1a2e; color: #eee; text-align: center;">
        </div>
        <div class="stat">
          <div class="stat-label">Azimut (¬∞)</div>
          <input type="number" id="calcAzimuth" value="180" step="1" min="0" max="360" style="width: 70px; padding: 5px; border-radius: 5px; border: 1px solid #444; background: #1a1a2e; color: #eee; text-align: center;">
        </div>
      </div>
      <div style="text-align: center; margin-top: 15px;">
        <button onclick="calculatePV()" style="padding: 8px 20px; border-radius: 5px; border: none; background: #a855f7; color: white; cursor: pointer; font-weight: bold;">Beregn</button>
      </div>
      <div style="text-align: center; margin-top: 15px;">
        <div class="stat-label">Estimert produksjon n√•</div>
        <div class="value sun" id="calcResult">--</div>
        <div class="unit">kW</div>
      </div>
      <div class="updated" style="margin-top: 10px; margin-bottom: 0;">
        Azimut: 0¬∞=N, 90¬∞=√ò, 180¬∞=S, 225¬∞=SV
      </div>
    </div>
  </div>

  <script>
    // Supabase config v1.10
    // Changelog:
    //   v1.0 - Initial version
    //   v1.1 - Added timestamps for min/max values
    //   v1.2 - Added rain statistics card
    //   v1.3 - Added wind card with Beaufort scale
    //   v1.4 - Added Siljan regional cards, changed wind to Snurrasen
    //   v1.5 - Added UV index, met.no data, reorganized layout
    //   v1.6 - Added 7-day forecast, MetAlerts, fog, precip next hour (direct from met.no)
    //   v1.7 - Added water levels section for Siljanvassdraget reservoirs
    //   v1.8 - Updated water level colors, added water warnings to alert box, added police log section
    //   v1.9 - Wind in m/s, water level trend arrows (3 days), fill percentage explanation
    //   v1.10 - Temp colors (blue<0, red>=0), lux display, solar panel card, PV calculator
    //   v1.10.1 - Bugfix: removed sun7 reference that crashed data7d/30d block
    //   v1.10.2 - Bugfix: NaN in rain average when no data
    //   v1.10.3 - Bugfix: regional rain shows date even when 0mm
    //   v1.10.4 - Lux calculated from weather_data irradiance (updates every minute)

    // v1.10: Temperature color (blue = frost, red = above zero)
    function getTempClass(temp) {
      if (temp === null || temp === undefined) return '';
      return temp < 0 ? 'temp-cold' : 'temp-warm';
    }

    // v1.10: Format temp with color
    function fmtTempColored(temp) {
      if (temp === null || temp === undefined) return '--';
      const cls = getTempClass(temp);
      return `<span class="${cls}">${fmt(temp)}¬∞C</span>`;
    }

    // v1.10: Sun position calculator
    function getSunPosition(date, lat, lon) {
      const rad = Math.PI / 180;
      const dayOfYear = Math.floor((date - new Date(date.getFullYear(), 0, 0)) / 86400000);
      const declination = 23.45 * Math.sin(rad * (360/365) * (dayOfYear - 81));
      const hourAngle = (date.getHours() + date.getMinutes()/60 - 12) * 15;
      const latRad = lat * rad;
      const declRad = declination * rad;
      const hourRad = hourAngle * rad;
      const altitude = Math.asin(Math.sin(latRad) * Math.sin(declRad) + Math.cos(latRad) * Math.cos(declRad) * Math.cos(hourRad)) / rad;
      const azimuth = Math.atan2(Math.sin(hourRad), Math.cos(hourRad) * Math.sin(latRad) - Math.tan(declRad) * Math.cos(latRad)) / rad + 180;
      return { altitude, azimuth };
    }

    // v1.10: Calculate angle of incidence for tilted panel
    function getAngleOfIncidence(sunAlt, sunAz, tilt, panelAz) {
      const rad = Math.PI / 180;
      const sunAltRad = sunAlt * rad;
      const sunAzRad = sunAz * rad;
      const tiltRad = tilt * rad;
      const panelAzRad = panelAz * rad;
      const cosAOI = Math.sin(sunAltRad) * Math.cos(tiltRad) + Math.cos(sunAltRad) * Math.sin(tiltRad) * Math.cos(sunAzRad - panelAzRad);
      return Math.max(0, cosAOI);
    }

    // v1.10: Estimate PV output
    function estimatePV(irradiance, kwp, tilt, azimuth, derate = 0.78) {
      const sun = getSunPosition(new Date(), METNO_LAT, METNO_LON);
      if (sun.altitude <= 0) return 0;
      const cosAOI = getAngleOfIncidence(sun.altitude, sun.azimuth, tilt, azimuth);
      return (irradiance / 1000) * kwp * cosAOI * derate;
    }
    
    const SUPABASE_URL = 'https://ygxhkdwhjyqpkmfzezxv.supabase.co';
    const SUPABASE_KEY = 'sb_publishable_wiJxJlwGbklxNgNjL4riJg_Hh55ayG0';
    const METNO_LAT = 59.2924;
    const METNO_LON = 9.7072;

    // Store water alerts globally for combining with MetAlerts
    let waterAlerts = [];
    let metAlerts = [];

    // Weather symbol to emoji mapping
    const weatherIcons = {
      clearsky_day: '‚òÄÔ∏è', clearsky_night: 'üåô', clearsky_polartwilight: 'üåÖ',
      fair_day: 'üå§Ô∏è', fair_night: 'üå§Ô∏è', fair_polartwilight: 'üå§Ô∏è',
      partlycloudy_day: '‚õÖ', partlycloudy_night: '‚õÖ', partlycloudy_polartwilight: '‚õÖ',
      cloudy: '‚òÅÔ∏è',
      rainshowers_day: 'üå¶Ô∏è', rainshowers_night: 'üå¶Ô∏è', rainshowers_polartwilight: 'üå¶Ô∏è',
      rainshowersandthunder_day: '‚õàÔ∏è', rainshowersandthunder_night: '‚õàÔ∏è',
      sleetshowers_day: 'üå®Ô∏è', sleetshowers_night: 'üå®Ô∏è',
      snowshowers_day: 'üå®Ô∏è', snowshowers_night: 'üå®Ô∏è',
      rain: 'üåßÔ∏è', heavyrain: 'üåßÔ∏è', lightrain: 'üåßÔ∏è',
      rainandthunder: '‚õàÔ∏è', heavyrainandthunder: '‚õàÔ∏è', lightrainandthunder: '‚õàÔ∏è',
      sleet: 'üå®Ô∏è', heavysleet: 'üå®Ô∏è', lightsleet: 'üå®Ô∏è',
      snow: '‚ùÑÔ∏è', heavysnow: '‚ùÑÔ∏è', lightsnow: '‚ùÑÔ∏è',
      snowandthunder: '‚õàÔ∏è', sleetandthunder: '‚õàÔ∏è',
      fog: 'üå´Ô∏è',
    };

    function getWeatherIcon(symbolCode) {
      if (!symbolCode) return '‚ùì';
      const base = symbolCode.replace(/_day|_night|_polartwilight/g, '');
      return weatherIcons[symbolCode] || weatherIcons[base] || '‚ùì';
    }

    async function fetchData(table, select = '*', filter = '', order = '', limit = '') {
      let url = `${SUPABASE_URL}/rest/v1/${table}?select=${select}`;
      if (filter) url += `&${filter}`;
      if (order) url += `&order=${order}`;
      if (limit) url += `&limit=${limit}`;
      
      const res = await fetch(url, {
        headers: {
          'apikey': SUPABASE_KEY,
          'Authorization': `Bearer ${SUPABASE_KEY}`
        }
      });
      return res.json();
    }

    async function fetchMetNo(endpoint) {
      const res = await fetch(`https://api.met.no/weatherapi/${endpoint}`, {
        headers: { 'User-Agent': 'SiljanWeather/1.0 github.com/vegard1977/vaerdata' }
      });
      return res.json();
    }

    function fmt(val, decimals = 1) {
      if (val === null || val === undefined || val === Infinity || val === -Infinity) return '--';
      return Number(val).toFixed(decimals);
    }

    function fmtTime(isoString) {
      if (!isoString) return '--';
      const d = new Date(isoString);
      return d.toLocaleTimeString('no-NO', { hour: '2-digit', minute: '2-digit' });
    }

    function fmtDateTime(isoString) {
      if (!isoString) return '--';
      const d = new Date(isoString);
      return d.toLocaleString('no-NO', { 
        day: 'numeric', month: 'short', hour: '2-digit', minute: '2-digit' 
      });
    }

    function fmtShortDate(isoString) {
      if (!isoString) return '--';
      const d = new Date(isoString);
      return d.toLocaleDateString('no-NO', { weekday: 'short', day: 'numeric' });
    }

    function fmtDayMonth(isoString) {
      if (!isoString) return '--';
      const d = new Date(isoString);
      return d.toLocaleDateString('no-NO', { day: 'numeric', month: 'short' });
    }

    function fmtDayName(isoString) {
      if (!isoString) return '--';
      const d = new Date(isoString);
      const today = new Date();
      const tomorrow = new Date(today);
      tomorrow.setDate(tomorrow.getDate() + 1);
      
      if (d.toDateString() === today.toDateString()) return 'I dag';
      if (d.toDateString() === tomorrow.toDateString()) return 'I morgen';
      return d.toLocaleDateString('no-NO', { weekday: 'short', day: 'numeric' });
    }

    function hoursAgo(h) {
      return new Date(Date.now() - h * 60 * 60 * 1000).toISOString();
    }

    function daysAgo(d) {
      return new Date(Date.now() - d * 24 * 60 * 60 * 1000).toISOString();
    }

    function getDateKey(isoString) {
      const d = new Date(isoString);
      return d.toISOString().split('T')[0];
    }

    function findMinMax(data, field) {
      let min = { val: Infinity, time: null };
      let max = { val: -Infinity, time: null };
      for (const d of data) {
        if (d[field] !== null && d[field] !== undefined) {
          if (d[field] < min.val) { min.val = d[field]; min.time = d.recorded_at; }
          if (d[field] > max.val) { max.val = d[field]; max.time = d.recorded_at; }
        }
      }
      return { min, max };
    }

    function getBeaufort(ms) {
      if (ms === null || ms === undefined) return { name: '--', class: '' };
      if (ms < 0.3) return { name: 'Stille', class: 'wind-calm' };
      if (ms < 1.6) return { name: 'Flau vind', class: 'wind-calm' };
      if (ms < 3.4) return { name: 'Svak vind', class: 'wind-calm' };
      if (ms < 5.5) return { name: 'Lett bris', class: 'wind-calm' };
      if (ms < 8.0) return { name: 'Laber bris', class: 'wind-moderate' };
      if (ms < 10.8) return { name: 'Frisk bris', class: 'wind-moderate' };
      if (ms < 13.9) return { name: 'Liten kuling', class: 'wind-moderate' };
      if (ms < 17.2) return { name: 'Stiv kuling', class: 'wind-strong' };
      if (ms < 20.8) return { name: 'Sterk kuling', class: 'wind-strong' };
      if (ms < 24.5) return { name: 'Liten storm', class: 'wind-strong' };
      if (ms < 28.5) return { name: 'Full storm', class: 'wind-strong' };
      if (ms < 32.7) return { name: 'Sterk storm', class: 'wind-strong' };
      return { name: 'Orkan', class: 'wind-strong' };
    }

    // Convert km/h to m/s
    function kmhToMs(kmh) {
      if (kmh === null || kmh === undefined) return null;
      return kmh / 3.6;
    }

    function getUvLevel(uv) {
      if (uv === null || uv === undefined) return { name: '--', class: '' };
      if (uv < 3) return { name: 'Lav', class: 'uv-low' };
      if (uv < 6) return { name: 'Moderat', class: 'uv-moderate' };
      if (uv < 8) return { name: 'H√∏y', class: 'uv-high' };
      if (uv < 11) return { name: 'Veldig h√∏y', class: 'uv-very-high' };
      return { name: 'Ekstrem', class: 'uv-extreme' };
    }

    function getWindDirection(deg) {
      if (deg === null || deg === undefined) return { arrow: '--', text: '--' };
      const directions = ['N', 'N√ò', '√ò', 'S√ò', 'S', 'SV', 'V', 'NV'];
      const arrows = ['‚Üì', '‚Üô', '‚Üê', '‚Üñ', '‚Üë', '‚Üó', '‚Üí', '‚Üò'];
      const index = Math.round(deg / 45) % 8;
      return { arrow: arrows[index], text: directions[index] };
    }

    // v1.8: Updated water level color logic
    function getFillColor(pct) {
      if (pct === null || pct === undefined) return { class: '', color: '#666' };
      if (pct < 0) return { class: 'fill-critical', color: '#ef4444' };       // Under LRV: Red
      if (pct < 10) return { class: 'fill-low', color: '#f97316' };           // 0-10%: Orange
      if (pct < 90) return { class: 'fill-normal', color: '#4ade80' };        // 10-90%: Green
      if (pct <= 100) return { class: 'fill-high', color: '#eab308' };        // 90-100%: Yellow
      return { class: 'fill-over', color: '#f97316' };                        // 100%+: Orange
    }

    // v1.8: Get water alert level
    function getWaterAlertLevel(pct) {
      if (pct === null || pct === undefined) return null;
      if (pct >= 110) return { level: 'danger', class: 'alert-water-danger', text: 'Over HRV' };
      if (pct >= 100) return { level: 'warning', class: 'alert-water-warning', text: 'Over HRV' };
      return null;
    }

    // v1.9: Get water level trend (compare with 3 days ago)
    function getWaterTrend(current, old) {
      if (current === null || old === null) return { arrow: '', class: '' };
      const diff = current - old;
      if (diff > 0.1) return { arrow: '‚Üë', class: 'water-trend-up' };
      if (diff < -0.1) return { arrow: '‚Üì', class: 'water-trend-down' };
      return { arrow: '‚Üí', class: 'water-trend-stable' };
    }

    function daysAgoISO(d) {
      return new Date(Date.now() - d * 24 * 60 * 60 * 1000).toISOString();
    }

    function calcDailyRain(data) {
      const dailyMax = {};
      for (const d of data) {
        if (d.rain_today === null || d.rain_today === undefined) continue;
        const dateKey = getDateKey(d.recorded_at);
        if (!dailyMax[dateKey] || d.rain_today > dailyMax[dateKey].val) {
          dailyMax[dateKey] = { val: d.rain_today, time: d.recorded_at };
        }
      }
      return dailyMax;
    }

    function calcRainStats(dailyMax, threshold = 0.2) {
      const days = Object.keys(dailyMax).sort();
      let rainDays = 0;
      let maxDay = { val: 0, date: null };
      let totalRain = 0;
      
      for (const day of days) {
        const rain = dailyMax[day].val;
        if (rain > threshold) {
          rainDays++;
          totalRain += rain;
        }
        if (rain > maxDay.val) {
          maxDay = { val: rain, date: dailyMax[day].time };
        }
      }

      let maxDryStreak = 0;
      let currentDryStreak = 0;
      for (const day of days) {
        if (dailyMax[day].val <= threshold) {
          currentDryStreak++;
          maxDryStreak = Math.max(maxDryStreak, currentDryStreak);
        } else {
          currentDryStreak = 0;
        }
      }

      const avgPerRainDay = rainDays > 0 ? totalRain / rainDays : 0;

      return { rainDays, maxDay, maxDryStreak, avgPerRainDay };
    }

    function calcDailyMax(data, field) {
      const dailyMax = {};
      for (const d of data) {
        if (d[field] === null || d[field] === undefined) continue;
        const dateKey = getDateKey(d.recorded_at);
        if (!dailyMax[dateKey] || d[field] > dailyMax[dateKey].val) {
          dailyMax[dateKey] = { val: d[field], time: d.recorded_at };
        }
      }
      return dailyMax;
    }

    // v1.8: Update combined alerts display
    function updateAlertDisplay() {
      const alertCard = document.getElementById('alertCard');
      const alertContent = document.getElementById('alertContent');
      
      const allAlerts = [...metAlerts, ...waterAlerts];
      
      if (allAlerts.length === 0) {
        alertCard.className = 'card alert';
        alertContent.innerHTML = '<span class="alert-none">‚úì Ingen aktive varsler</span>';
        return;
      }
      
      // Determine card severity
      let maxSeverity = 'yellow';
      for (const alert of allAlerts) {
        if (alert.severity === 'red') maxSeverity = 'red';
        else if (alert.severity === 'orange' && maxSeverity !== 'red') maxSeverity = 'orange';
      }
      
      alertCard.className = `card alert ${maxSeverity}`;
      
      let html = '';
      for (const alert of allAlerts) {
        html += `<div class="alert-item">
          <div class="alert-title ${alert.titleClass || ''}">${alert.title}</div>
          <div class="alert-desc">${alert.desc}</div>
        </div>`;
      }
      
      alertContent.innerHTML = html;
    }

    async function updateWaterLevels() {
      try {
        const reservoirs = ['Mykle', 'Sporevann', 'Gorningen', 'Vanebuvann', 'Ramsvatn'];
        const waterGrid = document.getElementById('waterGrid');
        waterGrid.innerHTML = '';
        
        let latestUpdate = null;
        waterAlerts = []; // Reset water alerts
        
        for (const reservoir of reservoirs) {
          // Get latest measurement
          const data = await fetchData(
            'water_levels', 
            '*', 
            `reservoir=eq.${reservoir}`, 
            'timestamp.desc', 
            '1'
          );
          
          // Get measurement from ~3 days ago for trend
          const oldData = await fetchData(
            'water_levels',
            '*',
            `reservoir=eq.${reservoir}&timestamp=lte.${daysAgoISO(3)}`,
            'timestamp.desc',
            '1'
          );
          
          const item = document.createElement('div');
          item.className = 'water-item';
          
          if (data.length > 0) {
            const d = data[0];
            const level = d.water_level;
            const hrv = d.hrv;
            const lrv = d.lrv;
            const fillPct = hrv && lrv ? ((level - lrv) / (hrv - lrv) * 100) : null;
            const fillStyle = getFillColor(fillPct);
            const barWidth = Math.min(Math.max(fillPct || 0, 0), 120);
            
            // Calculate trend
            const oldLevel = oldData.length > 0 ? oldData[0].water_level : null;
            const trend = getWaterTrend(level, oldLevel);
            
            if (!latestUpdate || d.timestamp > latestUpdate) {
              latestUpdate = d.timestamp;
            }
            
            // v1.8: Check for water alerts
            const alertLevel = getWaterAlertLevel(fillPct);
            if (alertLevel) {
              waterAlerts.push({
                title: `üåä ${reservoir}: ${fmt(fillPct, 0)}% fyllingsgrad`,
                desc: alertLevel.text,
                severity: alertLevel.level === 'danger' ? 'red' : 'orange',
                titleClass: alertLevel.class
              });
            }
            
            item.innerHTML = `
              <div class="reservoir-name">${reservoir}</div>
              <div class="water-level">${fmt(level, 2)} m</div>
              <div class="water-ref">LRV: ${fmt(lrv, 1)} ¬∑ HRV: ${fmt(hrv, 1)}</div>
              <div class="fill-pct ${fillStyle.class}">${fillPct !== null ? fmt(fillPct, 0) : '--'}%<span class="water-trend ${trend.class}">${trend.arrow}</span></div>
              <div class="fill-bar">
                <div class="fill-bar-inner" style="width: ${barWidth}%; background: ${fillStyle.color};"></div>
              </div>
            `;
          } else {
            item.innerHTML = `
              <div class="reservoir-name">${reservoir}</div>
              <div class="water-level">--</div>
              <div class="water-ref">Ingen data</div>
              <div class="fill-pct">--%</div>
              <div class="fill-bar"><div class="fill-bar-inner" style="width: 0%;"></div></div>
            `;
          }
          
          waterGrid.appendChild(item);
        }
        
        document.getElementById('waterUpdate').textContent = latestUpdate ? fmtDateTime(latestUpdate) : '--';
        
        // Update combined alert display
        updateAlertDisplay();
        
      } catch (err) {
        console.error('Feil ved henting av vannstand:', err);
      }
    }

    // v1.8: Police log function
    async function updatePoliceLog() {
      try {
        const data = await fetchData(
          'police_events',
          '*',
          '',
          'event_time.desc',
          '3'
        );
        
        const policeList = document.getElementById('policeList');
        
        if (data.length === 0) {
          policeList.innerHTML = `
            <div class="police-item">
              <div class="police-desc" style="color: #666;">Ingen hendelser registrert</div>
            </div>
          `;
          return;
        }
        
        let html = '';
        for (const event of data) {
          html += `
            <div class="police-item">
              <div class="police-title">${event.title || 'Ukjent hendelse'}</div>
              <div class="police-desc">${event.description || ''}</div>
              <div class="police-time">${fmtDateTime(event.event_time)}</div>
            </div>
          `;
        }
        
        policeList.innerHTML = html;
        
      } catch (err) {
        console.error('Feil ved henting av politilogg:', err);
      }
    }

    // v1.10: Solar data function
    let currentIrradiance = 0;
    async function updateSolarData() {
      try {
        const data = await fetchData(
          'solar_data',
          '*',
          '',
          'timestamp.desc',
          '1'
        );
        
        if (data.length > 0) {
          const d = data[0];
          currentIrradiance = d.irradiance || 0;
          // lux now comes from weather_data (v1.10.4)
          document.getElementById('solarInverter').textContent = fmt(d.inverter_kw, 2);
          document.getElementById('solarEstimated').textContent = fmt(d.estimated_kw, 2) + ' kW';
          document.getElementById('solarPerformance').textContent = fmt(d.performance_ratio, 0) + '%';
          document.getElementById('solarIrr').textContent = fmt(d.irradiance, 0) + ' W/m¬≤';
          document.getElementById('solarUpdate').textContent = fmtDateTime(d.timestamp);
        }
      } catch (err) {
        console.error('Feil ved henting av solcelledata:', err);
      }
    }

    // v1.10: PV Calculator
    function calculatePV() {
      const kwp = parseFloat(document.getElementById('calcKwp').value) || 0;
      const tilt = parseFloat(document.getElementById('calcTilt').value) || 0;
      const azimuth = parseFloat(document.getElementById('calcAzimuth').value) || 180;
      const result = estimatePV(currentIrradiance, kwp, tilt, azimuth);
      document.getElementById('calcResult').textContent = fmt(result, 2);
    }

    async function updateMetNoData() {
      try {
        const forecast = await fetchMetNo(`locationforecast/2.0/complete?lat=${METNO_LAT}&lon=${METNO_LON}`);
        
        if (forecast && forecast.properties && forecast.properties.timeseries) {
          const now = forecast.properties.timeseries[0];
          const instant = now.data.instant.details;
          
          document.getElementById('fog').textContent = fmt(instant.fog_area_fraction, 0) + '%';
          
          const precipNext = now.data.next_1_hours?.details?.precipitation_amount || 0;
          document.getElementById('precipNextHour').textContent = fmt(precipNext, 1) + ' mm';
          
          const dailyForecasts = {};
          for (const ts of forecast.properties.timeseries) {
            const date = getDateKey(ts.time);
            const hour = new Date(ts.time).getHours();
            
            if (!dailyForecasts[date]) {
              dailyForecasts[date] = { 
                temps: [], 
                symbol: null, 
                precip: 0,
                time: ts.time
              };
            }
            
            if (ts.data.instant?.details?.air_temperature !== undefined) {
              dailyForecasts[date].temps.push(ts.data.instant.details.air_temperature);
            }
            
            if (hour === 12 && ts.data.next_6_hours?.summary?.symbol_code) {
              dailyForecasts[date].symbol = ts.data.next_6_hours.summary.symbol_code;
            } else if (!dailyForecasts[date].symbol && ts.data.next_6_hours?.summary?.symbol_code) {
              dailyForecasts[date].symbol = ts.data.next_6_hours.summary.symbol_code;
            }
            
            if (ts.data.next_1_hours?.details?.precipitation_amount) {
              dailyForecasts[date].precip += ts.data.next_1_hours.details.precipitation_amount;
            }
          }
          
          const forecastDays = Object.keys(dailyForecasts).sort().slice(0, 7);
          const forecastGrid = document.getElementById('forecastGrid');
          forecastGrid.innerHTML = '';
          
          for (const date of forecastDays) {
            const day = dailyForecasts[date];
            const minTemp = Math.min(...day.temps);
            const maxTemp = Math.max(...day.temps);
            
            const dayEl = document.createElement('div');
            dayEl.className = 'forecast-day';
            const minCls = getTempClass(minTemp);
            const maxCls = getTempClass(maxTemp);
            dayEl.innerHTML = `
              <div class="day-name">${fmtDayName(day.time)}</div>
              <div class="weather-icon">${getWeatherIcon(day.symbol)}</div>
              <div class="temp-range">
                <span class="${minCls}">${fmt(minTemp, 0)}¬∞</span> / 
                <span class="${maxCls}">${fmt(maxTemp, 0)}¬∞</span>
              </div>
              ${day.precip > 0.1 ? `<div class="precip">${fmt(day.precip, 1)} mm</div>` : '<div class="precip">-</div>'}
            `;
            forecastGrid.appendChild(dayEl);
          }
        }
        
        // MetAlerts
        const alerts = await fetchMetNo(`metalerts/2.0/current.json?lat=${METNO_LAT}&lon=${METNO_LON}`);
        
        metAlerts = []; // Reset met alerts
        
        if (alerts && alerts.features && alerts.features.length > 0) {
          for (const feature of alerts.features) {
            const alert = feature.properties;
            const severity = alert.awareness_level || '';
            
            let severityLevel = 'yellow';
            if (severity.includes('orange') || severity.includes('Orange')) severityLevel = 'orange';
            if (severity.includes('red') || severity.includes('Red')) severityLevel = 'red';
            
            metAlerts.push({
              title: alert.eventAwarenessName || alert.event || 'Farevarsel',
              desc: alert.description || '',
              severity: severityLevel
            });
          }
        }
        
        // Update combined alert display
        updateAlertDisplay();
        
      } catch (err) {
        console.error('Feil ved henting av met.no data:', err);
      }
    }

    async function updateDashboard() {
      try {
        const latest = await fetchData('weather_data', '*', '', 'recorded_at.desc', '1');
        if (latest.length > 0) {
          const d = latest[0];
          document.getElementById('temp').textContent = fmt(d.temperature);
          document.getElementById('irr').textContent = fmt(d.irradiance, 0);
          // v1.10.4: Lux from weather_data (approx 120 lux per W/m¬≤)
          const luxValue = (d.irradiance || 0) * 120;
          document.getElementById('lux').textContent = luxValue > 0 ? fmt(luxValue, 0) + ' lx' : '0 lx';
          document.getElementById('rainToday').textContent = fmt(d.rain_today);
          document.getElementById('hum').textContent = fmt(d.humidity, 0);
          document.getElementById('dew').textContent = fmt(d.dew_point) + '¬∞C';
          document.getElementById('press').textContent = fmt(d.pressure, 0);
          document.getElementById('lastUpdate').textContent = fmtDateTime(d.recorded_at);
          
          const windSpeed = kmhToMs(d.wind_speed) || 0;
          document.getElementById('wind').textContent = fmt(windSpeed, 1);
          const beaufort = getBeaufort(windSpeed);
          const beaufortEl = document.getElementById('beaufort');
          beaufortEl.textContent = beaufort.name;
          beaufortEl.className = 'beaufort ' + beaufort.class;

          const uvVal = d.uv_index || 0;
          document.getElementById('uv').textContent = fmt(uvVal, 1);
          const uvLevel = getUvLevel(uvVal);
          const uvLevelEl = document.getElementById('uvLevel');
          uvLevelEl.textContent = uvLevel.name;
          uvLevelEl.className = 'beaufort ' + uvLevel.class;

          document.getElementById('windGust').textContent = fmt(kmhToMs(d.wind_gust), 1);
          const windDir = getWindDirection(d.wind_direction);
          document.getElementById('windDirArrow').textContent = windDir.arrow;
          document.getElementById('windDirText').textContent = windDir.text;
          document.getElementById('windDirDeg').textContent = d.wind_direction ? d.wind_direction + '¬∞' : '--';
          document.getElementById('clouds').textContent = fmt(d.cloud_cover, 0);
          document.getElementById('precipProb').textContent = fmt(d.precipitation_probability, 0) + '%';
          document.getElementById('thunderProb').textContent = fmt(d.thunder_probability, 0) + '%';

          document.getElementById('siljanTempMin').innerHTML = fmtTempColored(d.temp_min_daily);
          document.getElementById('siljanTempMax').innerHTML = fmtTempColored(d.temp_max_daily);
          document.getElementById('siljanRainMax').textContent = fmt(d.rain_max_daily);
          
          const siljanWind = kmhToMs(d.wind_max_daily) || 0;
          document.getElementById('siljanWindMax').textContent = fmt(siljanWind, 1);
          const siljanBeaufort = getBeaufort(siljanWind);
          const siljanBeaufortEl = document.getElementById('siljanWindBeaufort');
          siljanBeaufortEl.textContent = siljanBeaufort.name;
          siljanBeaufortEl.className = 'beaufort ' + siljanBeaufort.class;
        }

        const data24h = await fetchData('weather_data', '*', `recorded_at=gte.${hoursAgo(24)}`);
        if (data24h.length > 0) {
          const temp24 = findMinMax(data24h, 'temperature');
          document.getElementById('temp24min').textContent = fmt(temp24.min.val);
          document.getElementById('temp24max').textContent = fmt(temp24.max.val);
          document.getElementById('temp24times').textContent = `(${fmtTime(temp24.min.time)} / ${fmtTime(temp24.max.time)})`;

          const hum24 = findMinMax(data24h, 'humidity');
          document.getElementById('hum24min').textContent = fmt(hum24.min.val, 0);
          document.getElementById('hum24max').textContent = fmt(hum24.max.val, 0);
          document.getElementById('hum24times').textContent = `(${fmtTime(hum24.min.time)} / ${fmtTime(hum24.max.time)})`;

          const press24 = findMinMax(data24h, 'pressure');
          document.getElementById('press24min').textContent = fmt(press24.min.val, 0);
          document.getElementById('press24max').textContent = fmt(press24.max.val, 0);
          document.getElementById('press24times').textContent = `(${fmtTime(press24.min.time)} / ${fmtTime(press24.max.time)})`;

          const wind24 = findMinMax(data24h, 'wind_speed');
          document.getElementById('wind24max').textContent = fmt(kmhToMs(wind24.max.val), 1) + ' m/s';
          document.getElementById('wind24time').textContent = fmtTime(wind24.max.time);

          const uv24 = findMinMax(data24h, 'uv_index');
          document.getElementById('uv24max').textContent = fmt(uv24.max.val, 1);
          document.getElementById('uv24time').textContent = fmtTime(uv24.max.time);

          const gust24 = findMinMax(data24h, 'wind_gust');
          document.getElementById('gust24max').textContent = fmt(kmhToMs(gust24.max.val), 1) + ' m/s';
          document.getElementById('gust24time').textContent = fmtTime(gust24.max.time);

          const clouds24 = findMinMax(data24h, 'cloud_cover');
          document.getElementById('clouds24min').textContent = fmt(clouds24.min.val, 0) + '%';
          document.getElementById('clouds24minTime').textContent = fmtTime(clouds24.min.time);
          document.getElementById('clouds24max').textContent = fmt(clouds24.max.val, 0) + '%';
          document.getElementById('clouds24maxTime').textContent = fmtTime(clouds24.max.time);

          const thunder24 = findMinMax(data24h, 'thunder_probability');
          document.getElementById('thunderProb24max').textContent = fmt(thunder24.max.val, 0) + '%';
          document.getElementById('thunderProb24time').textContent = fmtTime(thunder24.max.time);

          const irr24 = findMinMax(data24h, 'irradiance');
          document.getElementById('irrMax').textContent = fmt(irr24.max.val, 0) + ' W/m¬≤';
          document.getElementById('irrMaxTime').textContent = fmtTime(irr24.max.time);

          const sunMinutes24 = data24h.filter(d => d.irradiance > 120).length;
          document.getElementById('sun24').textContent = fmt(sunMinutes24 / 60) + 't';

          const daily24 = calcDailyRain(data24h);
          const rain24total = Object.values(daily24).reduce((sum, d) => sum + d.val, 0);
          document.getElementById('rain24').textContent = fmt(rain24total) + ' mm';
        }

        const data3h = await fetchData('weather_data', 'pressure,recorded_at', `recorded_at=gte.${hoursAgo(3)}`, 'recorded_at.asc');
        if (data3h.length > 1) {
          const first = data3h[0].pressure;
          const last = data3h[data3h.length - 1].pressure;
          const diff = last - first;
          const trendEl = document.getElementById('pressTrend');
          if (diff > 1) {
            trendEl.innerHTML = `<span class="trend-up">‚Üë +${fmt(diff, 1)}</span>`;
          } else if (diff < -1) {
            trendEl.innerHTML = `<span class="trend-down">‚Üì ${fmt(diff, 1)}</span>`;
          } else {
            trendEl.textContent = `‚Üí ${fmt(diff, 1)}`;
          }
        }

        const data7d = await fetchData('weather_data', '*', `recorded_at=gte.${daysAgo(7)}`);
        if (data7d.length > 0) {
          const temp7 = findMinMax(data7d, 'temperature');
          document.getElementById('temp7min').textContent = fmt(temp7.min.val);
          document.getElementById('temp7max').textContent = fmt(temp7.max.val);
          document.getElementById('temp7times').textContent = `(${fmtShortDate(temp7.min.time)} / ${fmtShortDate(temp7.max.time)})`;

          const uv7 = findMinMax(data7d, 'uv_index');
          document.getElementById('uv7max').textContent = fmt(uv7.max.val, 1);
          document.getElementById('uv7date').textContent = fmtShortDate(uv7.max.time);

          const siljanTempMin7 = findMinMax(data7d, 'temp_min_daily');
          const siljanTempMax7 = findMinMax(data7d, 'temp_max_daily');
          document.getElementById('siljanTempMin7').innerHTML = fmtTempColored(siljanTempMin7.min.val);
          document.getElementById('siljanTempMin7date').textContent = fmtShortDate(siljanTempMin7.min.time);
          document.getElementById('siljanTempMax7').innerHTML = fmtTempColored(siljanTempMax7.max.val);
          document.getElementById('siljanTempMax7date').textContent = fmtShortDate(siljanTempMax7.max.time);

          const siljanWind7 = findMinMax(data7d, 'wind_max_daily');
          document.getElementById('siljanWind7max').textContent = fmt(kmhToMs(siljanWind7.max.val), 1) + ' m/s';
          document.getElementById('siljanWind7date').textContent = fmtShortDate(siljanWind7.max.time);

          const siljanRain7daily = calcDailyMax(data7d, 'rain_max_daily');
          const siljanRain7vals = Object.values(siljanRain7daily);
          let siljanRain7max = { val: 0, time: null };
          for (const v of siljanRain7vals) {
            if (v.val >= siljanRain7max.val) siljanRain7max = v;  // >= to capture date even when 0
          }
          document.getElementById('siljanRain7max').textContent = siljanRain7vals.length > 0 
            ? fmt(siljanRain7max.val) + ' mm' 
            : '-- mm';
          document.getElementById('siljanRain7date').textContent = siljanRain7max.time 
            ? fmtDayMonth(siljanRain7max.time) 
            : (siljanRain7vals.length > 0 ? 'ingen nedb√∏r' : '--');

          const hums = data7d.map(d => d.humidity).filter(h => h !== null);
          document.getElementById('hum7avg').textContent = fmt(hums.reduce((a, b) => a + b, 0) / hums.length, 0) + '%';

          const presses = data7d.map(d => d.pressure).filter(p => p !== null);
          document.getElementById('press7avg').textContent = fmt(presses.reduce((a, b) => a + b, 0) / presses.length, 0);

          const wind7 = findMinMax(data7d, 'wind_speed');
          document.getElementById('wind7max').textContent = fmt(kmhToMs(wind7.max.val), 1) + ' m/s';
          document.getElementById('wind7time').textContent = fmtShortDate(wind7.max.time);

          // sun7 removed - no UI element exists

          const daily7 = calcDailyRain(data7d);
          const rain7total = Object.values(daily7).reduce((sum, d) => sum + d.val, 0);
          document.getElementById('rain7').textContent = fmt(rain7total) + ' mm';

          const stats7 = calcRainStats(daily7);
          document.getElementById('rainMax7').textContent = fmt(stats7.maxDay.val) + ' mm';
          document.getElementById('rainMax7date').textContent = fmtDayMonth(stats7.maxDay.date);
          document.getElementById('rainDays7').textContent = stats7.rainDays;
        }

        const data30d = await fetchData('weather_data', '*', `recorded_at=gte.${daysAgo(30)}`);
        if (data30d.length > 0) {
          const temp30 = findMinMax(data30d, 'temperature');
          document.getElementById('temp30min').textContent = fmt(temp30.min.val);
          document.getElementById('temp30max').textContent = fmt(temp30.max.val);
          document.getElementById('temp30times').textContent = `(${fmtShortDate(temp30.min.time)} / ${fmtShortDate(temp30.max.time)})`;

          const uv30 = findMinMax(data30d, 'uv_index');
          document.getElementById('uv30max').textContent = fmt(uv30.max.val, 1);
          document.getElementById('uv30date').textContent = fmtShortDate(uv30.max.time);

          const siljanTempMin30 = findMinMax(data30d, 'temp_min_daily');
          const siljanTempMax30 = findMinMax(data30d, 'temp_max_daily');
          document.getElementById('siljanTempMin30').innerHTML = fmtTempColored(siljanTempMin30.min.val);
          document.getElementById('siljanTempMin30date').textContent = fmtShortDate(siljanTempMin30.min.time);
          document.getElementById('siljanTempMax30').innerHTML = fmtTempColored(siljanTempMax30.max.val);
          document.getElementById('siljanTempMax30date').textContent = fmtShortDate(siljanTempMax30.max.time);

          const siljanWind30 = findMinMax(data30d, 'wind_max_daily');
          document.getElementById('siljanWind30max').textContent = fmt(kmhToMs(siljanWind30.max.val), 1) + ' m/s';
          document.getElementById('siljanWind30date').textContent = fmtShortDate(siljanWind30.max.time);
          
          const siljanWindVals = data30d.map(d => d.wind_max_daily).filter(w => w !== null && w !== undefined);
          const siljanWindAvg = siljanWindVals.length > 0 ? siljanWindVals.reduce((a, b) => a + b, 0) / siljanWindVals.length : null;
          document.getElementById('siljanWindAvg').textContent = siljanWindAvg !== null 
            ? fmt(kmhToMs(siljanWindAvg), 1) + ' m/s' 
            : '-- m/s';

          const siljanRain30daily = calcDailyMax(data30d, 'rain_max_daily');
          const siljanRain30vals = Object.values(siljanRain30daily);
          let siljanRain30max = { val: 0, time: null };
          let siljanRain30total = 0;
          for (const v of siljanRain30vals) {
            if (v.val >= siljanRain30max.val) siljanRain30max = v;  // >= to capture date even when 0
            siljanRain30total += v.val;
          }
          document.getElementById('siljanRain30max').textContent = siljanRain30vals.length > 0 
            ? fmt(siljanRain30max.val) + ' mm' 
            : '-- mm';
          document.getElementById('siljanRain30date').textContent = siljanRain30max.time 
            ? fmtDayMonth(siljanRain30max.time) 
            : (siljanRain30vals.length > 0 ? 'ingen nedb√∏r' : '--');
          document.getElementById('siljanRainAvg').textContent = siljanRain30vals.length > 0 
            ? fmt(siljanRain30total / siljanRain30vals.length) + ' mm' 
            : '-- mm';

          const wind30 = findMinMax(data30d, 'wind_speed');
          document.getElementById('wind30max').textContent = fmt(kmhToMs(wind30.max.val), 1) + ' m/s';
          document.getElementById('wind30time').textContent = fmtShortDate(wind30.max.time);

          const daily30 = calcDailyRain(data30d);
          const rain30total = Object.values(daily30).reduce((sum, d) => sum + d.val, 0);
          document.getElementById('rain30').textContent = fmt(rain30total) + ' mm';

          const stats30 = calcRainStats(daily30);
          document.getElementById('rainMax30').textContent = fmt(stats30.maxDay.val) + ' mm';
          document.getElementById('rainMax30date').textContent = fmtDayMonth(stats30.maxDay.date);
          document.getElementById('rainDays30').textContent = stats30.rainDays;
          document.getElementById('dryStreak').textContent = stats30.maxDryStreak + ' dager';
          document.getElementById('rainAvgPerDay').textContent = fmt(stats30.avgPerRainDay) + ' mm';
        }

      } catch (err) {
        console.error('Feil ved henting av data:', err);
      }
    }

    // Initial load
    updateDashboard();
    updateMetNoData();
    updateWaterLevels();
    updatePoliceLog();
    updateSolarData();
    
    // Refresh intervals
    setInterval(updateDashboard, 60000);       // Database data every minute
    setInterval(updateMetNoData, 900000);      // Met.no data every 15 minutes
    setInterval(updateWaterLevels, 3600000);   // Water levels every hour
    setInterval(updatePoliceLog, 300000);      // Police log every 5 minutes
    setInterval(updateSolarData, 60000);       // Solar data every minute
  </script>
</body>
</html>
